---
    classes:
        - wget
        - java
        - logstash
        - common::logstash
        - python
        - curator

    logstash::package_url: 'https://artifacts.elastic.co/downloads/logstash/logstash-5.5.0.rpm'
    logstash::jvm_options:
        - '-Xms512m'
        - '-Xmx512m'
    logstash::service_provider: 'systemd'
    logstash:status: 'enabled'

    common::logstash::kinesis_stream_name: 'els-srch-vi-test'
    common::logstash::application_name: 'dynamo_test'
    common::logstash::hosts: '10.231.230.10:9200'
    common::logstash::region: 'us-east-1'
    common::logstash::custom_configs:
      kinesis:
        inline_template: |
          input {
            kinesis {
              kinesis_stream_name => "<%= scope['common::logstash::kinesis_stream_name'] %>"
              codec               => json {}
              application_name    => "<%= scope['common::logstash::application_name'] %>"
              region              => "<%= scope['common::logstash::region'] %>"
            }
          }

      amazon_es:
        inline_template: |
          output {
            if [application] == "Zookeeper" {
              elasticsearch {
                hosts         => ["<%= scope['common::logstash::hosts'] %>"]
                index         => "zookeeper-%%{%}{+YYYY.MM.dd}"
                template      => "/etc/logstash/zookeeper-template.json"
                template_name => "zookeeper"
              }
              }
          }

    common::logstash::custom_jsons:
        /etc/logstash/zookeeper-template.json:
            json:
                order: 0
                template: zookeeper-*
                settings:
                    index.refresh_interval: 5s
                mappings:
                    logs:
                      dynamic_templates:
                      - message_field:
                          path_match: message
                          mapping:
                            norms: false
                            type: text
                          match_mapping_type: string
                      - string_fields:
                          mapping:
                            norms: false
                            type: text
                            fields:
                              keyword:
                                ignore_above: 256
                                type: keyword
                          match_mapping_type: string
                          match: "*"
                      _all:
                        norms: false
                        enabled: true
                      properties:
                        "@timestamp":
                          include_in_all: false
                          type: date
                        geoip:
                          dynamic: true
                          properties:
                            ip:
                              type: ip
                            latitude:
                              type: half_float
                            location:
                              type: geo_point
                            longitude:
                              type: half_float
                        "@version":
                          include_in_all: false
                          type: keyword

    logstash_plugins:
        logstash-input-kinesis:
            source: NULL
    python::pip: "present"
    curator::provider: 'pip'
    curator::host: "10.231.230.10"
    curator::jobs:
        logstash_close:
            command: "close"
            older_than: 1
            cron_hour: 10
            cron_minute: 10
